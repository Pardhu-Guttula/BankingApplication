name: CI/CD Pipeline
on:
 push:
 branches:
 - main
 pull_request:
 branches:
 - main
jobs:
 build:
 runs-on: ubuntu-latest
 steps:
 - name: Checkout Source Code
 uses: actions/checkout@v2
 - name: Set up JDK 11
 uses: actions/setup-java@v2
 with:
 java-version: 11
 - name: Build using Gradle
 run: ./gradlew build
 - name: Upload Build Artifacts
 uses: actions/upload-artifact@v2
 with:
 name: build-artifacts
 path: build/libs
deploy:
 runs-on: ubuntu-latest
 needs: build
 steps:
 - name: Download Build Artifacts
 uses: actions/download-artifact@v2
 with:
 name: build-artifacts
 path: build/libs
 - name: Deploy to Google Cloud
 env:
 GOOGLE_APPLICATION_CREDENTIALS: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS }}
 run: |
 gcloud auth activate-service-account --key-file $GOOGLE_APPLICATION_CREDENTIALS
 gcloud config set project ${{ secrets.GCP_PROJECT_ID }}
 gcloud app deploy build/libs/myapp.jar